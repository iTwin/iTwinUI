// Copyright (c) Bentley Systems, Incorporated. All rights reserved.
// See LICENSE.md in the project root for license terms and full copyright notice.
@import './color';

@mixin no-link {
  text-decoration: none;

  @include themed {
    color: t(iui-text-color);
  }

  &:link,
  &:visited,
  &:hover,
  &:active {
    @include themed {
      color: t(iui-text-color);
    }
    text-decoration: none;
  }
}

@mixin iui-focus($box-shadow-value: iui-focus-box-shadow) {
  &:focus {
    outline: 0;

    @include themed {
      box-shadow: t($box-shadow-value);
    }
  }

  &:focus:not(:focus-visible) {
    box-shadow: none;
  }

  &:focus-visible {
    outline: 0;

    @include themed {
      box-shadow: t($box-shadow-value);
    }
  }
}

@mixin iui-reset {
  margin: 0;
  padding: 0;
  border: none;
  vertical-align: baseline;
}

@mixin iui-anchor {
  @include iui-focus;
  text-decoration: none;
  cursor: pointer;
  @include themed {
    color: t(iui-color-foreground-primary);
  }

  &:hover {
    @include themed {
      color: t(iui-color-foreground-primary-overlay);
    }
    text-decoration: underline;
  }
}

@mixin iui-scrollbar {
  @include themed {
    scrollbar-color: rgba(t(iui-color-foreground-body-rgb), t(iui-opacity-4)) transparent;
    scrollbar-width: thin;
  }

  &::-webkit-scrollbar {
    width: $iui-s;
    height: $iui-s;
  }

  &::-webkit-scrollbar-thumb {
    @include themed {
      background-color: rgba(t(iui-color-foreground-body-rgb), t(iui-opacity-4));
    }
    border-radius: $iui-s * 0.5;

    &:hover {
      @include themed {
        background-color: rgba(t(iui-color-foreground-body-rgb), t(iui-opacity-3));
      }
    }
  }

  &::-webkit-scrollbar-track,
  &::-webkit-scrollbar-corner {
    background-color: transparent;
  }
}

@mixin iui-line-clamp($lines: 1) {
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;

  @supports (-webkit-line-clamp: 1) {
    white-space: unset;
    display: -webkit-box; /* stylelint-disable-line */
    -webkit-line-clamp: $lines;
    -webkit-box-orient: vertical; /* stylelint-disable-line */
  }
}

@mixin iui-blur($opacity: 4) {
  // Blur fallback
  @include themed {
    background-color: rgba(0, 0, 0, t(iui-opacity-#{$opacity - 1}));
  }

  // With blur
  @supports (backdrop-filter: $iui-blur-filter) {
    @include themed() {
      background-color: rgba(0, 0, 0, t(iui-opacity-#{$opacity}));
      backdrop-filter: $iui-blur-filter;
    }
  }
}

/// Simulates display: none but keeps the element in DOM tree
@mixin iui-display-none {
  opacity: 0;
  height: 0.1px;
  width: 0.1px;
  margin: 0;
  padding: 0;
}

/// Classes for react-transition-group
/// Used for expand/collapse transitions. Needs height/width to be set in JS.
@mixin iui-transition-group {
  $transition-rule: opacity $iui-speed-fast ease-out, width $iui-speed-fast ease-out, height $iui-speed-fast ease-out;

  &.iui-enter {
    opacity: 0;
  }

  &.iui-enter-active {
    opacity: 1;
    @media (prefers-reduced-motion: no-preference) {
      transition: $transition-rule;
    }
  }

  &.iui-exit {
    opacity: 1;
  }

  &.iui-exit-active {
    opacity: 0;
    @media (prefers-reduced-motion: no-preference) {
      transition: $transition-rule;
    }
  }
}

/// Adds the ability to toggle vertical scroll snapping by setting `.iui-scroll-snapping` as a modifier (if used inside a class) or at root level.
/// @arg $selector - selector to apply `scroll-snap-align: start` on. Defaults to '> *'
@mixin iui-scroll-snapping($selector: '> *') {
  #{if(&, '&.iui-scroll-snapping', '.iui-scroll-snapping')} {
    scroll-snap-type: y mandatory;

    #{$selector} {
      scroll-snap-align: start;
    }
  }
}

/// Shadow shown over scrollable areas
@mixin iui-scroll-shadow($background-color: t(iui-color-background-1)) {
  @include themed {
    background:
      // Shadow to maintain background color on whole component
      linear-gradient(
        transparent $iui-s,
        $background-color $iui-s calc(100% - #{$iui-s}),
        transparent calc(100% - #{$iui-s})
      ),
      // Cover top shadow
      linear-gradient($background-color 0% 100%) center top,
      // Cover bottom shadow
      linear-gradient($background-color 0% 100%) center bottom,
      // Top shadow
      linear-gradient(180deg, rgba(0, 0, 0, t(iui-opacity-6)) 20%, $background-color) center top,
      // Bottom shadow
      linear-gradient(0deg, rgba(0, 0, 0, t(iui-opacity-6)) 20%, $background-color) center bottom;
  }

  background-repeat: no-repeat;
  background-size: 100% 100%, 100% $iui-xl, 100% $iui-xl, 100% $iui-s, 100% $iui-s;
  background-attachment: scroll, local, local, scroll, scroll;
}
