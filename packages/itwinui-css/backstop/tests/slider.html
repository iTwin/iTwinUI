<!--
  Copyright (c) Bentley Systems, Incorporated. All rights reserved.
  See LICENSE.md in the project root for license terms and full copyright notice.
-->

<!DOCTYPE html>
<html
  lang="en-US"
  id="theme"
>
  <head>
    <meta charset="UTF-8">
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1"
    >
    <title>Slider | iTwinUI</title>

    <script type="module">
      import "./assets/theme.js";
      import "@itwin/itwinui-icons-elements/sound-mute";
      import "@itwin/itwinui-icons-elements/sound-loud";
    </script>
    <style>
      @import url("./assets/demo.css") layer(demo);
      @import url('@itwin/itwinui-variables') layer(variables);
      @import url("@itwin/itwinui-css/css/all.css") layer(itwinui);
      section[id^='demo'] {
        width: auto;
        display: flex;
        gap: 2rem;
      }
      section[id^='demo-horizontal'] { flex-direction: column; }
      section[id^='demo-vertical'] { height: calc(var(--iui-size-3xl) * 5); }
      .iui-tooltip { display: none; }
      .iui-slider .iui-slider-thumb:focus + .iui-tooltip,
      .iui-slider .iui-slider-thumb:hover + .iui-tooltip,
      .iui-slider .iui-slider-thumb.iui-active + .iui-tooltip {
        position: absolute;
        display: block;
        margin-top: calc(var(--iui-size-xl) * -1);
        transform: translateX(-50%);
      }
    </style>

  </head>

  <body
    class="iui-root"
    data-iui-theme
  >
    <theme-button></theme-button>
    <h1>Slider</h1>
    <hr />
    <br>

    <h2>Horizontal</h2>
    <section id="demo-horizontal">
      <div
        class="iui-slider iui-progress-slider"
        data-iui-orientation="horizontal"
      >
        <div
          class="iui-slider-track"
          style="width: 50%;"
        ></div>
        <div
          class="iui-slider-thumb"
          role="slider"
          tabindex="0"
          aria-label="Volume setting"
          aria-orientation="horizontal"
          aria-valuemin="0"
          aria-valuenow="50"
          aria-valuemax="100"
          style="left: 50%;"
          id="test-slider-1"
        ></div>
        <output
          class="iui-tooltip"
          style="left: 50%;"
        >
          50
        </output>
      </div>

      <div
        class="iui-slider iui-progress-slider"
        data-iui-orientation="horizontal"
      >
        <div
          class="iui-slider-track"
          style="width: 50%;"
        ></div>
        <div
          class="iui-slider-thumb"
          role="slider"
          aria-label="Volume setting"
          aria-orientation="horizontal"
          aria-valuemin="0"
          aria-valuenow="50"
          aria-valuemax="100"
          aria-disabled="true"
          style="left: 50%;"
          id="test-slider-1"
        ></div>
        <output
          class="iui-tooltip"
          style="left: 50%;"
        >
          50
        </output>
      </div>

      <div
        class="iui-slider iui-progress-slider"
        data-iui-orientation="horizontal"
        data-iui-disabled="true"
      >
        <div
          class="iui-slider-track"
          style="width: 50%;"
        ></div>
        <div
          class="iui-slider-thumb"
          role="slider"
          aria-label="Volume setting"
          aria-orientation="horizontal"
          aria-valuemin="0"
          aria-valuenow="50"
          aria-valuemax="100"
          aria-disabled="true"
          style="left: 50%;"
          id="test-slider-1"
        ></div>
        <output
          class="iui-tooltip"
          style="left: 50%;"
        >
          50
        </output>
      </div>
    </section>
    <br />

    <h3>With container</h3>
    <section id="demo-horizontal-container">
      <div class="iui-slider-container">
        <div
          class="iui-slider iui-progress-slider"
          data-iui-orientation="horizontal"
        >
          <div
            class="iui-slider-track"
            style="width: 50%;"
          ></div>
          <div
            style="left: 50%;"
            class="iui-slider-thumb"
            role="slider"
            tabindex="0"
            aria-label="Volume setting"
            aria-valuemin="0"
            aria-valuenow="50"
            aria-valuemax="100"
            id="test-slider-1"
          ></div>
          <output
            class="iui-tooltip"
            style="left: 50%;"
          >
            50
          </output>
        </div>
        <div class="iui-slider-ticks">
          <span class="iui-slider-tick">0</span>
          <span class="iui-slider-tick">10</span>
          <span class="iui-slider-tick">20</span>
          <span class="iui-slider-tick">30</span>
          <span class="iui-slider-tick">40</span>
          <span class="iui-slider-tick">50</span>
          <span class="iui-slider-tick">60</span>
          <span class="iui-slider-tick">70</span>
          <span class="iui-slider-tick">80</span>
          <span class="iui-slider-tick">90</span>
          <span class="iui-slider-tick">100</span>
        </div>
      </div>

      <div
        class="iui-slider-container"
        aria-orientation="horizontal"
      >
        <span class="iui-slider-min">
          <svg-sound-mute
            class="iui-icon"
            aria-hidden="true"
          ></svg-sound-mute>
        </span>
        <div
          class="iui-slider iui-progress-slider"
          data-iui-orientation="horizontal"
        >
          <div
            class="iui-slider-track"
            style="width: 50%;"
          ></div>
          <div
            style="left: 50%;"
            class="iui-slider-thumb"
            role="slider"
            tabindex="0"
            aria-label="Volume setting"
            aria-valuemin="0"
            aria-valuenow="50"
            aria-valuemax="100"
            id="test-slider-1"
          ></div>
          <output
            class="iui-tooltip"
            style="left: 50%;"
          >
            50
          </output>
        </div>
        <div class="iui-slider-ticks">
          <span class="iui-slider-tick">0</span>
          <span class="iui-slider-tick">10</span>
          <span class="iui-slider-tick">20</span>
          <span class="iui-slider-tick">30</span>
          <span class="iui-slider-tick">40</span>
          <span class="iui-slider-tick">50</span>
          <span class="iui-slider-tick">60</span>
          <span class="iui-slider-tick">70</span>
          <span class="iui-slider-tick">80</span>
          <span class="iui-slider-tick">90</span>
          <span class="iui-slider-tick">100</span>
        </div>
        <span class="iui-slider-max">
          <svg-sound-loud
            class="iui-icon"
            aria-hidden="true"
          ></svg-sound-loud>
        </span>
      </div>

      <div
        class="iui-slider-container"
        aria-orientation="horizontal"
      >
        <span class="iui-slider-min">
          0
        </span>
        <div
          class="iui-slider iui-progress-slider"
          data-iui-orientation="horizontal"
        >
          <div
            class="iui-slider-track"
            style="width: 50%;"
          ></div>
          <div
            style="left: 50%;"
            class="iui-slider-thumb"
            role="slider"
            tabindex="0"
            aria-label="Volume setting"
            aria-valuemin="0"
            aria-valuenow="50"
            aria-valuemax="100"
            id="test-slider-1"
          ></div>
          <output
            class="iui-tooltip"
            style="left: 50%;"
          >
            50
          </output>
        </div>
        <div class="iui-slider-ticks">
          <span class="iui-slider-tick">0</span>
          <span class="iui-slider-tick">10</span>
          <span class="iui-slider-tick">20</span>
          <span class="iui-slider-tick">30</span>
          <span class="iui-slider-tick">40</span>
          <span class="iui-slider-tick">50</span>
          <span class="iui-slider-tick">60</span>
          <span class="iui-slider-tick">70</span>
          <span class="iui-slider-tick">80</span>
          <span class="iui-slider-tick">90</span>
          <span class="iui-slider-tick">100</span>
        </div>
        <span class="iui-slider-max">
          100
        </span>
      </div>

      <div
        class="iui-slider-container"
        aria-orientation="horizontal"
      >
        <span class="iui-slider-min">
          0
        </span>
        <div
          class="iui-slider iui-progress-slider"
          data-iui-orientation="horizontal"
          data-iui-disabled="true"
        >
          <div
            class="iui-slider-track"
            style="width: 50%;"
          ></div>
          <div
            style="left: 50%;"
            class="iui-slider-thumb"
            role="slider"
            aria-label="Volume setting"
            aria-valuemin="0"
            aria-valuenow="50"
            aria-valuemax="100"
            aria-disabled="true"
            id="test-slider-1"
          ></div>
          <output
            class="iui-tooltip"
            style="left: 50%;"
          >
            50
          </output>
        </div>
        <div class="iui-slider-ticks">
          <span class="iui-slider-tick">0</span>
          <span class="iui-slider-tick">10</span>
          <span class="iui-slider-tick">20</span>
          <span class="iui-slider-tick">30</span>
          <span class="iui-slider-tick">40</span>
          <span class="iui-slider-tick">50</span>
          <span class="iui-slider-tick">60</span>
          <span class="iui-slider-tick">70</span>
          <span class="iui-slider-tick">80</span>
          <span class="iui-slider-tick">90</span>
          <span class="iui-slider-tick">100</span>
        </div>
        <span class="iui-slider-max">
          100
        </span>
      </div>
    </section>
    <br />

    <h2>Vertical</h2>
    <section id="demo-vertical">
      <div
        class="iui-slider iui-progress-slider"
        data-iui-orientation="vertical"
      >
        <div
          class="iui-slider-track"
          style="height: 50%;"
        ></div>
        <div
          class="iui-slider-thumb"
          role="slider"
          tabindex="0"
          aria-label="Volume setting"
          aria-orientation="vertical"
          aria-valuemin="0"
          aria-valuenow="50"
          aria-valuemax="100"
          style="bottom: 50%;"
          id="test-slider-1"
        ></div>
        <output
          class="iui-tooltip"
          style="left: 50%;"
        >
          50
        </output>
      </div>

      <div
        class="iui-slider iui-progress-slider"
        data-iui-orientation="vertical"
      >
        <div
          class="iui-slider-track"
          style="height: 50%;"
        ></div>
        <div
          class="iui-slider-thumb"
          role="slider"
          aria-label="Volume setting"
          aria-orientation="vertical"
          aria-valuemin="0"
          aria-valuenow="50"
          aria-valuemax="100"
          aria-disabled="true"
          style="bottom: 50%;"
          id="test-slider-1"
        ></div>
        <output
          class="iui-tooltip"
          style="left: 50%;"
        >
          50
        </output>
      </div>

      <div
        class="iui-slider iui-progress-slider"
        data-iui-orientation="vertical"
        data-iui-disabled="true"
      >
        <div
          class="iui-slider-track"
          style="height: 50%;"
        ></div>
        <div
          class="iui-slider-thumb"
          role="slider"
          aria-label="Volume setting"
          aria-orientation="vertical"
          aria-valuemin="0"
          aria-valuenow="50"
          aria-valuemax="100"
          aria-disabled="true"
          style="bottom: 50%;"
          id="test-slider-1"
        ></div>
        <output
          class="iui-tooltip"
          style="left: 50%;"
        >
          50
        </output>
      </div>
    </section>
    <br />

    <h3>With container</h3>
    <section id="demo-vertical-container">
      <div class="iui-slider-container">
        <div
          class="iui-slider iui-progress-slider"
          data-iui-orientation="vertical"
        >
          <div
            class="iui-slider-track"
            style="height: 50%;"
          ></div>
          <div
            style="bottom: 50%;"
            class="iui-slider-thumb"
            role="slider"
            tabindex="0"
            aria-label="Volume setting"
            aria-valuemin="0"
            aria-valuenow="50"
            aria-valuemax="100"
            id="test-slider-1"
          ></div>
          <output
            class="iui-tooltip"
            style="left: 50%;"
          >
            50
          </output>
        </div>
        <div class="iui-slider-ticks">
          <span class="iui-slider-tick">0</span>
          <span class="iui-slider-tick">10</span>
          <span class="iui-slider-tick">20</span>
          <span class="iui-slider-tick">30</span>
          <span class="iui-slider-tick">40</span>
          <span class="iui-slider-tick">50</span>
          <span class="iui-slider-tick">60</span>
          <span class="iui-slider-tick">70</span>
          <span class="iui-slider-tick">80</span>
          <span class="iui-slider-tick">90</span>
          <span class="iui-slider-tick">100</span>
        </div>
      </div>

      <div
        class="iui-slider-container"
        aria-orientation="vertical"
      >
        <span class="iui-slider-min">
          <svg-sound-mute
            class="iui-icon"
            aria-hidden="true"
          ></svg-sound-mute>
        </span>
        <div
          class="iui-slider iui-progress-slider"
          data-iui-orientation="vertical"
        >
          <div
            class="iui-slider-track"
            style="height: 50%;"
          ></div>
          <div
            style="bottom: 50%;"
            class="iui-slider-thumb"
            role="slider"
            tabindex="0"
            aria-label="Volume setting"
            aria-valuemin="0"
            aria-valuenow="50"
            aria-valuemax="100"
            id="test-slider-1"
          ></div>
          <output
            class="iui-tooltip"
            style="left: 50%;"
          >
            50
          </output>
        </div>
        <div class="iui-slider-ticks">
          <span class="iui-slider-tick">0</span>
          <span class="iui-slider-tick">10</span>
          <span class="iui-slider-tick">20</span>
          <span class="iui-slider-tick">30</span>
          <span class="iui-slider-tick">40</span>
          <span class="iui-slider-tick">50</span>
          <span class="iui-slider-tick">60</span>
          <span class="iui-slider-tick">70</span>
          <span class="iui-slider-tick">80</span>
          <span class="iui-slider-tick">90</span>
          <span class="iui-slider-tick">100</span>
        </div>
        <span class="iui-slider-max">
          <svg-sound-loud
            class="iui-icon"
            aria-hidden="true"
          ></svg-sound-loud>
        </span>
      </div>

      <div
        class="iui-slider-container"
        aria-orientation="vertical"
      >
        <span class="iui-slider-min">
          0
        </span>
        <div
          class="iui-slider iui-progress-slider"
          data-iui-orientation="vertical"
        >
          <div
            class="iui-slider-track"
            style="height: 50%;"
          ></div>
          <div
            style="bottom: 50%;"
            class="iui-slider-thumb"
            role="slider"
            tabindex="0"
            aria-label="Volume setting"
            aria-valuemin="0"
            aria-valuenow="50"
            aria-valuemax="100"
            id="test-slider-1"
          ></div>
          <output
            class="iui-tooltip"
            style="left: 50%;"
          >
            50
          </output>
        </div>
        <div class="iui-slider-ticks">
          <span class="iui-slider-tick">0</span>
          <span class="iui-slider-tick">10</span>
          <span class="iui-slider-tick">20</span>
          <span class="iui-slider-tick">30</span>
          <span class="iui-slider-tick">40</span>
          <span class="iui-slider-tick">50</span>
          <span class="iui-slider-tick">60</span>
          <span class="iui-slider-tick">70</span>
          <span class="iui-slider-tick">80</span>
          <span class="iui-slider-tick">90</span>
          <span class="iui-slider-tick">100</span>
        </div>
        <span class="iui-slider-max">
          100
        </span>
      </div>


    </section>

    <script>

      function setTooltip(percent, tooltip, sliderContainer) {
        if (getIsVerticalSlider(sliderContainer)) {
          if (tooltip) {
            tooltip.style.bottom = `${percent}%`;
            tooltip.innerHTML = `${percent}`;
          }
        } else {
          if (tooltip) {
            tooltip.style.left = `${percent}%`;
            tooltip.innerHTML = `${percent}`;
          }
        }
      }

      function setThumbAndTrack(percent, thumb, otherThumb, progress, sliderContainer, mode) {
        if (getIsVerticalSlider(sliderContainer)) {
          if (mode === "progress") {
            thumb.style.bottom = `${percent}%`;
            var progressPercent = 100 - percent;
            progress.style.top = `${progressPercent}%`;
            console.log(`${percent}%`);
          }
          else if (mode === "range-left") {
            otherThumb && otherThumb.setAttribute("aria-valuemin", percent + 1);
            thumb.style.bottom = `${percent}%`;
            progress.style.bottom = `${percent}%`;
            console.log(`${percent}% - ${otherThumb.getAttribute("aria-valuenow")}%`);
          } else if (mode === "range-right") {
            otherThumb && otherThumb.setAttribute("aria-valuemax", percent - 1);
            thumb.style.bottom = `${percent}%`;
            var progressPercent = 100 - percent;
            progress.style.top = `${progressPercent}%`;
            console.log(`${otherThumb.getAttribute("aria-valuenow")}% - ${percent}%`);
          }
        } else {
          if (mode === "progress") {
            thumb.style.left = `${percent}%`;
            var progressPercent = 100 - percent;
            progress.style.right = `${progressPercent}%`;
          } else if (mode === "range-left") {
            otherThumb && otherThumb.setAttribute("aria-valuemin", percent + 1);
            thumb.style.left = `${percent}%`;
            progress.style.left = `${percent}%`;
          } else if (mode === "range-right") {
            otherThumb && otherThumb.setAttribute("aria-valuemax", percent - 1);
            thumb.style.left = `${percent}%`;
            var progressPercent = 100 - percent;
            progress.style.right = `${progressPercent}%`;
          }
        }
      }

      function getMinValueFromThumb(thumb) {
        const minAtt = thumb.getAttribute("aria-valuemin");
        const dataRangeMinAtt = thumb.getAttribute("data-range-min");
        const min = parseInt(null !== dataRangeMinAtt ? dataRangeMinAtt : minAtt);
        return min;
      }

      function getMaxValueFromThumb(thumb) {
        const maxAtt = thumb.getAttribute("aria-valuemax");
        const dataRangeMaxAtt = thumb.getAttribute("data-range-max");
        const max = parseInt(null !== dataRangeMaxAtt ? dataRangeMaxAtt : maxAtt);
        return max;
      }

      function getMaxLimitValueFromThumb(thumb) {
        var maxAtt = thumb.getAttribute("aria-valuemax");
        var max = parseInt(maxAtt);
        return max;
      }

      function getMinLimitValueFromThumb(thumb) {
        var minAtt = thumb.getAttribute("aria-valuemin");
        var min = parseInt(minAtt);
        return min;
      }

      function getPercentFromThumb(thumb) {
        var valueAtt = thumb.getAttribute("aria-valuenow");
        var value = parseInt(valueAtt);
        var min = getMinValueFromThumb(thumb);
        var max = getMaxValueFromThumb(thumb);
        var percent = ((value - min) / (max - min)) * 100;
        return percent;
      }

      function moveSlider(event, thumb, track, progress, mode, toolTip, otherThumb, sliderContainer) {
        var min = getMinValueFromThumb(thumb);
        var limitMin = getMinLimitValueFromThumb(thumb);
        var max = getMaxValueFromThumb(thumb);
        var limitMax = getMaxLimitValueFromThumb(thumb);
        var rect = track.getBoundingClientRect();
        var diff;
        var trackLength;
        if (getIsVerticalSlider(sliderContainer)) {
          trackLength = rect.height;
          diff = - (event.pageY - (rect.bottom + window.scrollY));
          if (diff > rect.height)
            diff = rect.height;
          if (diff < 0)
            diff = 0;
        } else {
          trackLength = rect.width;
          diff = event.pageX - rect.left;
          if (diff > rect.width)
            diff = rect.width;
          if (diff < 0)
            diff = 0;
        }

        var percent = parseInt(((max - min) * diff) / trackLength);
        if (percent < limitMin)
          percent = limitMin;
        if (percent > limitMax)
          percent = limitMax;

        thumb.setAttribute("aria-valuenow", percent);
        setTooltip(percent, toolTip, sliderContainer);
        setThumbAndTrack(percent, thumb, otherThumb, progress, sliderContainer, mode);

        event.preventDefault();
        event.stopPropagation();
      }

      function getOtherRangeThumb(thumb) {
        var parent = thumb.parentNode;
        const allThumbs = parent.querySelectorAll(".iui-slider-thumb");
        for (var i = 0; i < allThumbs.length; i++) {
          if (allThumbs[i] !== thumb)
            return allThumbs[i];
        }
      }

      function getToolTip(thumb, mode) {
        const parent = thumb.parentNode;
        const tooltips = parent.querySelectorAll(".iui-tooltip");
        if (mode === "range-left")
          return tooltips[0];
        else if (mode === "range-right")
          return tooltips[1];

        return tooltips[0];
      }

      function getIsVerticalSlider(sliderContainer) {
        // return sliderContainer.parentNode.classList.contains("iui-slider-vertical");
        return sliderContainer.getAttribute('aria-orientation') === 'vertical';
      }

      function initializeThumbProcessing(thumb, sliderContainer, mode) {
        const percent = getPercentFromThumb(thumb);
        let progress = sliderContainer.querySelector(".iui-slider-track");
        let otherThumb = getOtherRangeThumb(thumb);
        const toolTip = getToolTip(thumb, mode);

        setTooltip(percent, toolTip, sliderContainer);
        setThumbAndTrack(percent, thumb, otherThumb, progress, sliderContainer, mode);

        thumb.addEventListener("mousedown", function () {
          if (sliderContainer.parentElement.classList.contains('iui-disabled'))
            return;
          thumb.classList.add("iui-active");
          sliderContainer.classList.add("iui-grabbing");
          var ownerDoc = thumb.ownerDocument;
          var track = sliderContainer.querySelector(".iui-slider::before");
          var handleMouseMove = function (event) {
            moveSlider(event, thumb, track, progress, mode, toolTip, otherThumb, sliderContainer);
          };

          var handleMouseUp = function (event) {
            ownerDoc.removeEventListener('mousemove', handleMouseMove);
            ownerDoc.removeEventListener('mouseup', handleMouseUp);
            thumb.classList.remove("iui-active");
            sliderContainer.classList.remove("iui-grabbing");
          };

          // bind a mousemove event handler to move pointer
          ownerDoc.addEventListener('mousemove', handleMouseMove);

          // bind a mouseup event handler to stop tracking mouse movements
          ownerDoc.addEventListener('mouseup', handleMouseUp);

          event.preventDefault();
          event.stopPropagation();
        });
      }

      function initializeAllProgressSliders() {
        const allProgressSliderContainers = document.querySelectorAll(".iui-slider.iui-progress-slider");
        allProgressSliderContainers.forEach(progressSliderContainer => {
          const thumb = progressSliderContainer.querySelector(".iui-slider-thumb");
          initializeThumbProcessing(thumb, progressSliderContainer, "progress");
        });
      }

      function initializeAllRangeSliders() {
        const allRangeSliderContainers = document.querySelectorAll(".iui-slider-container.iui-range-slider");
        allRangeSliderContainers.forEach(rangeSliderContainer => {
          const thumbs = rangeSliderContainer.querySelectorAll(".iui-slider-thumb");

          const leftThumb = thumbs[0];
          if (leftThumb) {
            initializeThumbProcessing(leftThumb, rangeSliderContainer, "range-left");
          }

          const rightThumb = thumbs[1];
          if (rightThumb) {
            initializeThumbProcessing(rightThumb, rangeSliderContainer, "range-right");
          }
        });
      }

      initializeAllProgressSliders();
      initializeAllRangeSliders();
    </script>
  </body>
</html>
