// Copyright (c) Bentley Systems, Incorporated. All rights reserved.
// See LICENSE.md in the project root for license terms and full copyright notice.

:where([data-iui-bridge='true']) {
  --iui-color-white: var(--kiwi-color-static-white);

  --iui-color-background: var(--kiwi-color-bg-neutral-base);
  --iui-color-background-disabled: var(--kiwi-color-bg-glow-on-surface-disabled);
  --iui-color-background-zebra: var(--kiwi-color-bg-glow-on-surface-disabled); /* TODO: Not sure */
  --iui-color-background-hover: var(--iui-color-background);
  --iui-color-background-backdrop: var(--kiwi-color-bg-surface-primary);
  --iui-color-background-backdrop-hover: var(--iui-color-background-backdrop);
  --iui-color-background-accent: var(--kiwi-color-bg-accent-base);
  --iui-color-background-accent-hover: var(--iui-color-background-accent);
  --iui-color-background-accent-muted: var(--kiwi-color-bg-accent-muted);

  --iui-color-border-foreground: var(--kiwi-color-border-mono-muted);
  --iui-color-border-foreground-hover: var(--iui-color-border-foreground);

  --iui-color-background-informational: var(--kiwi-color-bg-info-base);
  --iui-color-background-informational-hover: var(--iui-color-background-informational);
  --iui-color-background-informational-muted: var(--kiwi-color-bg-info-muted);
  --iui-color-background-positive: var(--kiwi-color-bg-positive-base);
  --iui-color-background-positive-hover: var(--iui-color-background-positive);
  --iui-color-background-positive-muted: var(--kiwi-color-bg-positive-muted);
  --iui-color-background-warning: var(--kiwi-color-bg-attention-base);
  --iui-color-background-warning-hover: var(--iui-color-background-warning);
  --iui-color-background-warning-muted: var(--kiwi-color-bg-attention-muted);
  --iui-color-background-negative: var(--kiwi-color-bg-critical-base);
  --iui-color-background-negative-hover: var(--iui-color-background-negative);
  --iui-color-background-negative-muted: var(--kiwi-color-bg-critical-muted);

  --iui-color-border-informational: var(--kiwi-color-border-info-base);
  --iui-color-border-positive: var(--kiwi-color-border-positive-base);
  --iui-color-border-warning: var(--kiwi-color-border-attention-base);
  --iui-color-border-negative: var(--kiwi-color-border-critical-base);

  --iui-color-border: var(--kiwi-color-border-neutral-base);
  --iui-color-border-hover: var(--iui-color-border);
  --iui-color-border-disabled: var(--kiwi-color-border-glow-on-surface-disabled);

  /* TODO: Not sure. E.g. --kiwi-color-border-neutral-muted for Surface is an issue since
    border-neutral-muted === bg-neutral-base. So border is invisible. So, should we use -faded instead? Same problem I
    think with Divider (iui-color-border-subtle) inside of a Surface (iui-color-background) */
  --iui-color-border-subtle: var(--kiwi-color-border-neutral-base);

  --iui-color-border-accent: var(--kiwi-color-border-accent-strong);

  --iui-color-icon-accent: var(--kiwi-color-icon-accent-strong);
  --iui-color-icon-informational: var(--kiwi-color-icon-info-faded);
  --iui-color-icon-positive: var(--kiwi-color-icon-positive-faded);
  --iui-color-icon-warning: var(--kiwi-color-icon-attention-faded);
  --iui-color-icon-negative: var(--kiwi-color-icon-critical-faded);

  --iui-color-icon: var(--kiwi-color-icon-neutral-base);
  --iui-color-icon-hover: var(--iui-color-icon);
  --iui-color-icon-muted: var(--kiwi-color-icon-neutral-secondary); /* TODO: or --kiwi-color-icon-neutral-muted? */
  --iui-color-icon-muted-hover: var(--iui-color-icon-muted);
  --iui-color-icon-disabled: var(--kiwi-color-icon-neutral-disabled);
  --iui-color-icon-disabled-hover: var(--iui-color-icon-disabled);

  --iui-color-text-informational: var(--kiwi-color-text-info-faded);
  --iui-color-text-positive: var(--kiwi-color-text-positive-faded);
  --iui-color-text-warning: var(--kiwi-color-text-attention-faded);
  --iui-color-text-negative: var(--kiwi-color-text-critical-faded);

  // TODO: status-hover variables are not being used anywhere in iTwinUi v3. Investigate.
  --iui-color-text-informational-hover: var(--iui-color-text-informational);
  --iui-color-text-positive-hover: var(--iui-color-text-positive);
  --iui-color-text-warning-hover: var(--iui-color-text-warning);
  --iui-color-text-negative-hover: var(--iui-color-text-negative);

  --iui-color-text: var(--kiwi-color-text-neutral-primary);
  --iui-color-text-hover: var(--iui-color-text);
  --iui-color-text-accent: var(--kiwi-color-text-accent-strong); /* TODO: -accent-strong or -accent-base? */
  --iui-color-text-accent-hover: var(--iui-color-text-accent);
  --iui-color-text-muted: var(--kiwi-color-text-neutral-secondary);
  --iui-color-text-disabled: var(--kiwi-color-text-neutral-disabled);
  --iui-color-text-disabled-hover: var(--iui-color-text-disabled);
  --iui-color-text-placeholder: var(--kiwi-color-text-neutral-secondary);

  /* TODO: Handle hsl */

  /* ---------------------------------------------------------------------------- */
  /* Anchor */

  .iui-anchor {
    // TODO: use underline prop
    text-decoration: underline;

    &:where(:hover) {
      text-decoration-color: transparent;
    }

    // Neutral color instead of accent
    &:where(:not([data-iui-status])) {
      color: var(--kiwi-color-text-neutral-primary);
    }
  }

  /* ---------------------------------------------------------------------------- */
  /* Breadcrumbs */

  .iui-breadcrumbs {
    // Neutral color instead of accent
    --_iui-breadcrumbs-content-color-default: var(--iui-color-text);

    .iui-breadcrumbs-content {
      // Manually add underline for any non iui-anchor links (since we don't have underline prop)
      &:any-link {
        text-decoration: underline;

        &:where(:hover) {
          text-decoration-color: transparent;
        }
      }
    }
  }

  /* ---------------------------------------------------------------------------- */
  /* Button */

  .iui-button {
    // This is needed because for CTA buttons, border-hover variables are set to bg variables
    --_iui-field-color-border-hover: var(--_iui-field-color-border);

    --_iui-field-color-border-disabled: transparent;

    // CTA variant should use the same colors as high-visibility instead of using "positive" colors
    &:where([data-iui-variant='high-visibility'], [data-iui-variant='cta']) {
      --_iui-field-color-background: var(--kiwi-color-bg-accent-base);
      --_iui-field-color-background-hover: var(--_iui-field-color-background);
      --_iui-field-color-icon: var(--kiwi-color-icon-neutral-emphasis);
      --_iui-field-color-border: var(--kiwi-color-border-accent-base);
    }
  }

  /* ---------------------------------------------------------------------------- */
  /* Checkbox/Radio */

  :is(.iui-checkbox, .iui-radio) {
    --_iui-checkbox-unchecked-svg: url('data:image/svg+xml;utf8,<svg viewBox="0 0 16 16"></svg>');
    --_iui-checkbox-checkmark-svg: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M11.2 5.6 6.8 10l-2-2"/></svg>');
    --_iui-checkbox-indeterminate-svg: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5 8h6.5"/></svg>');

    &:not(:disabled):not(.iui-checkbox-visibility) {
      --_iui-checkbox-svg-color: var(--kiwi-color-icon-neutral-emphasis);
      --_iui-checkbox-background-color: var(--kiwi-color-bg-neutral-base);
      --_iui-checkbox-border-color: var(--kiwi-color-border-neutral-base);

      &:checked {
        --_iui-checkbox-background-color: var(--kiwi-color-bg-accent-base);
        --_iui-checkbox-border-color: var(--kiwi-color-border-accent-base);
      }
    }

    &:disabled {
      --_iui-checkbox-border-color: transparent;
    }

    &.iui-checkbox-visibility {
      /* TODO: What to do about indeterminate? */
      --_iui-checkbox-unchecked-svg: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M1.961 6.807a.5.5 0 0 0-.922.386L1.5 7l-.461.193v.002l.002.004.006.013a3.404 3.404 0 0 0 .094.202A9.478 9.478 0 0 0 2.923 9.87l-1.277 1.277a.5.5 0 1 0 .708.707l1.326-1.326a7.13 7.13 0 0 0 2.174 1.145l-.801 1.603a.5.5 0 1 0 .894.448l.907-1.814a7.253 7.253 0 0 0 2.292 0l.907 1.814a.5.5 0 1 0 .894-.448l-.801-1.603a7.13 7.13 0 0 0 2.174-1.145l1.326 1.326a.5.5 0 0 0 .708-.707L13.077 9.87a9.479 9.479 0 0 0 1.782-2.456 5.53 5.53 0 0 0 .074-.158l.02-.044.006-.013.001-.004.001-.001L14.5 7l.461.193a.5.5 0 0 0-.922-.386l-.003.007-.014.03a7.227 7.227 0 0 1-.319.605c-.234.4-.593.93-1.086 1.46C11.63 9.968 10.13 11 8 11S4.369 9.968 3.383 8.91A8.478 8.478 0 0 1 2.04 6.972a4.479 4.479 0 0 1-.075-.16l-.003-.006Z"/></svg>');
      --_iui-checkbox-checkmark-svg: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.14 7.849C2.736 6.774 4.616 4 8 4c3.383 0 5.263 2.774 5.86 3.849a.304.304 0 0 1 0 .302C13.264 9.226 11.384 12 8 12c-3.383 0-5.263-2.774-5.86-3.849a.304.304 0 0 1 0-.302ZM8 3C4.023 3 1.887 6.244 1.265 7.363a1.304 1.304 0 0 0 0 1.274C1.887 9.756 4.023 13 8 13c3.977 0 6.113-3.244 6.735-4.363a1.304 1.304 0 0 0 0-1.274C14.113 6.244 11.977 3 8 3ZM7 8a1 1 0 1 1 2 0 1 1 0 0 1-2 0Zm1-2a2 2 0 1 0 0 4 2 2 0 0 0 0-4Z"/></svg>');

      --_iui-checkbox-background-color: transparent;
      --_iui-checkbox-border-color: transparent;
    }
  }

  /* TODO: ITwinUI variables */
  .iui-checkbox-wrapper {
    &:not(:where([data-iui-status])) {
      color: var(--kiwi-color-text-neutral-secondary);
    }

    &:is([data-iui-disabled='true'], .iui-disabled) {
      color: var(--kiwi-color-text-neutral-disabled);
    }
  }

  /* ---------------------------------------------------------------------------- */
  /* DropdownMenu */

  // To match iTwinUI v5 menu
  .iui-menu {
    background-color: var(--kiwi-color-bg-surface-tertiary);
    border: none;
    box-shadow: var(--kiwi-shadow-surface-xl);
  }

  .iui-list-item {
    // Since iTwinUI v3 has hover background color but iTwinUI v5 doesn't
    --_iui-list-item-background-hover: transparent;
  }

  /* ---------------------------------------------------------------------------- */
  /* ExpandableBlock */

  .iui-expandable-header:where(:not([data-iui-disabled='true'])):where(:hover) {
    --_iui-expandable-block-header-caption-color-hover: var(--iui-color-text-muted);
  }

  /* ---------------------------------------------------------------------------- */
  /* FileUpload */

  .iui-file-upload.iui-drag > .iui-content {
    // To give anchor text the accent color since iTwinUI v5 anchors are regular color.
    .iui-anchor {
      color: var(--iui-color-text-accent);
    }
  }

  /* ---------------------------------------------------------------------------- */
  /* Footer */

  .iui-legal-footer-item {
    // Since iTwinUI v5 anchors colors are not muted
    a {
      color: var(--iui-color-text-muted);
    }
  }

  /* ---------------------------------------------------------------------------- */
  /* Input */

  .iui-input:not([role='combobox']) {
    // Since iTwinUI v5 input background colors are different from global values
    --_iui-field-color-background: var(--kiwi-color-bg-surface-base); /* TODO: bg-neutral-primary or bg-neutral-base */
    --_iui-field-color-background-hover: var(--_iui-field-color-background);
    --_iui-field-color-background-disabled: var(--kiwi-color-bg-surface-base);
  }

  .iui-input-flex-container {
    // Since iTwinUI input v5 background colors are different from global values
    --_iui-input-background-color: var(--kiwi-color-bg-neutral-primary);
  }

  /* ---------------------------------------------------------------------------- */
  /* ProgressRadial */

  // Since iTwinUI v5 progress indicators's default color is not accent
  :is(.iui-progress-indicator-linear, .iui-progress-indicator-radial) {
    --_iui-progress-indicator-color-default-progress: var(--kiwi-color-icon-neutral-base);
  }

  /* ---------------------------------------------------------------------------- */
  /* SideNav */

  .iui-sidenav-button {
    svg {
      max-inline-size: unset; /* TODO: See how to avoid this workaround when reset layer is there */
    }
  }

  /* ---------------------------------------------------------------------------- */
  /* Surface */
  /* TODO: Confirm if Surface needs to use the kiwi variables starting with --kiwi-color-bg-surface-xyz */

  /* ---------------------------------------------------------------------------- */
  /* Slider */
  /* TODO: Since Slider is experimental in Kiwi, revisit this when stable on the Kiwi end */
  /* TODO: Are minLabel and maxLabel fills/colors correct? */

  // To match iTwinUI v5 slider thumb colors
  .iui-slider-thumb {
    background-color: var(--kiwi-color-bg-neutral-faded);
    border-color: var(--kiwi-color-border-neutral-faded);
  }

  /* ---------------------------------------------------------------------------- */
  /* Tabs */

  :where(.iui-tabs-wrapper) {
    // The old accent stripe is now the regular stripe
    --_iui-tab-color-stripe-blue: var(--kiwi-color-border-neutral-inverse);
    // The old positive stripe is now the accent stripe
    --_iui-tab-color-stripe-green: var(--kiwi-color-border-accent-strong);

    // iTwinUI v5 has muted color on its non selected tabs
    --_iui-tab-color-default: var(--kiwi-color-text-neutral-tertiary);
    // iTwinUI v5 has no accent color on its selected tabs
    --_iui-tab-color-selected: var(--kiwi-color-text-neutral-primary);
    // The old positive color is now the accent color
    --_iui-tab-color-green-selected: var(--kiwi-color-text-accent-strong);

    // Selected tab has stripe on the bottom instead of top
    &:where(.iui-horizontal) .iui-tab::after {
      inset-inline: 4px;
      inline-size: calc(100% - 4px * 2);
      inset-block-start: calc(100% - var(--iui-size-3xs));
    }

    // Selected tab has stripe on the right instead of left
    &:where(.iui-vertical) .iui-tab::after {
      inset-block: 4px;
      block-size: calc(100% - 4px * 2);
      inset-inline-start: calc(100% - var(--iui-size-3xs));
    }
  }

  .iui-tab {
    // To prevent outline from overlapping with the stripe
    outline-offset: -6px;

    // To match iTwinUI v5 tab styles
    background-color: transparent;
    border: none;
    border-radius: calc(4px + 6px); /* To account for outline-offset */
  }

  // To match iTwinUI v5 tab styles
  .iui-tabs-content {
    background-color: transparent;
    border: none;
  }

  /* ---------------------------------------------------------------------------- */
  /* ToggleSwitch */

  // TODO: Simplify
  .iui-toggle-switch {
    --iui-color-background: var(--kiwi-color-bg-surface-primary); /* TODO: Variable */

    &:checked {
      &:not(:disabled) {
        border-color: var(--kiwi-color-border-accent-base);
      }
    }

    &:where([disabled], :disabled, [aria-disabled='true']) {
      &::after {
        box-shadow: none;
        background-color: var(--kiwi-color-icon-neutral-disabled);
      }
    }
  }

  .iui-toggle-switch:disabled {
    background-color: var(--kiwi-color-bg-surface-primary);
    border-color: var(--kiwi-color-border-glow-on-surface-disabled);
  }

  .iui-toggle-switch-wrapper {
    color: var(--kiwi-color-text-neutral-secondary);

    &.iui-disabled {
      color: var(--kiwi-color-text-neutral-disabled);
    }
  }

  /* ---------------------------------------------------------------------------- */
  /* Tooltip */

  // To match iTwinUI v5 tooltip styles
  .iui-tooltip {
    background-color: var(--kiwi-color-bg-surface-emphasis);
    border-color: var(--kiwi-color-border-surface-primary);
    box-shadow: var(--kiwi-shadow-tooltip-base);
  }

  /* ---------------------------------------------------------------------------- */
  /* Icon */

  .iui-svg-icon {
    /* TODO: icon-neutral-base or text-neutral-primary */
    --_iui-svg-icon-fill-default: var(--kiwi-color-icon-neutral-base);
  }
}
