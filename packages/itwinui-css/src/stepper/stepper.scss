// Copyright (c) Bentley Systems, Incorporated. All rights reserved.
// See LICENSE.md in the project root for license terms and full copyright notice.
@import '../style/index';
@import '../text/index';

@mixin iui-stepper {
  --_iui-stepper-circle-size: #{$iui-l};
}

@mixin iui-stepper-list {
  @include iui-reset;
  display: flex;
  justify-content: space-around;
  align-items: flex-start;
  width: 100%;
}

@mixin iui-stepper-step {
  display: flex;
  flex: 1;
  align-items: center;
  flex-direction: column;
  color: var(--iui-color-foreground-positive);
  position: relative;
  counter-increment: section;
  @include iui-text(small);

  // Track
  &::before {
    --_iui-stepper-track-first-half: var(--iui-color-foreground-positive);
    --_iui-stepper-track-second-half: var(--iui-color-foreground-positive);

    content: '';
    width: 100%;
    height: $iui-xxs;
    position: absolute;
    top: calc(var(--_iui-stepper-circle-size) * 0.5);
    background: linear-gradient(
      90deg,
      var(--_iui-stepper-track-first-half) 50%,
      var(--_iui-stepper-track-second-half) 50%
    );

    @media (forced-colors: active) {
      background-color: CanvasText;
    }
  }

  // Step
  &::after {
    content: counter(section);
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    font-variant-numeric: tabular-nums;
    width: var(--_iui-stepper-circle-size);
    height: var(--_iui-stepper-circle-size);
    border-radius: $iui-border-radius-round;
    overflow-wrap: break-word;
    user-select: none;
    transition: background-color $iui-speed-fast ease-out, border-color $iui-speed-fast ease-out,
      color $iui-speed-fast ease-out;
    border: 1px solid;
    position: absolute;
    top: 0;
    color: inherit;
  }

  // Completed steps
  &::after {
    background-color: var(--iui-color-background-1);
    border-color: var(--iui-color-foreground-positive);
    color: var(--iui-color-foreground-positive);
  }

  // Current step
  &[aria-current] {
    color: var(--iui-color-foreground-positive);
    font-weight: $iui-font-weight-semibold;

    &::before {
      --_iui-stepper-track-first-half: var(--iui-color-foreground-positive);
      --_iui-stepper-track-second-half: var(--iui-color-background-5);
    }

    &::after {
      color: var(--iui-color-foreground-accessory);
      border-color: var(--iui-color-background-positive);
      background-color: var(--iui-color-background-positive);
      @media (forced-colors: active) {
        background-color: CanvasText;
        border-color: CanvasText;
        color: Canvas;
      }
    }
  }

  // Future steps
  &[aria-current] ~ & {
    color: var(--iui-text-color-muted);

    &::before {
      --_iui-stepper-track-first-half: var(--iui-color-background-5);
      --_iui-stepper-track-second-half: var(--iui-color-background-5);
    }

    &::after {
      border-color: var(--iui-color-background-5);
      color: inherit;
    }
  }

  // First step
  &:first-of-type::before {
    --_iui-stepper-track-first-half: transparent;
  }

  // Last step
  &:last-of-type::before {
    --_iui-stepper-track-second-half: transparent !important;
  }

  // Clickable steps
  &[tabindex] {
    cursor: pointer;
    @media (prefers-reduced-motion: no-preference) {
      transition: background-color $iui-speed-fast ease-out;
    }

    &:hover::after {
      color: var(--iui-color-foreground-accessory);
      border: 1px solid var(--iui-color-background-positive);
      background-color: var(--iui-color-background-positive);
    }

    @include focus-visible {
      outline: 0;

      &::after {
        outline: $iui-xxs solid var(--iui-color-foreground-positive);
        outline-offset: -1px;
      }
    }
  }
}

@mixin iui-stepper-step-name {
  color: inherit;
  margin-top: calc(var(--_iui-stepper-circle-size) + $iui-xxs);
  text-align: center;
  user-select: all;
}

@mixin iui-stepper-label {
  display: block;
  font-size: $iui-font-size-subheading;
  margin-top: calc(var(--_iui-stepper-circle-size) + 8px);
  text-align: center;
}

@mixin iui-stepper-count {
  color: var(--iui-text-color-muted);
  margin-right: $iui-s;
  user-select: none;
}
