<!--
  Copyright (c) Bentley Systems, Incorporated. All rights reserved.
  See LICENSE.md in the project root for license terms and full copyright notice.
-->

<!DOCTYPE html>
<html
  lang="en-US"
  id="theme"
>
  <head>
    <meta charset="UTF-8">
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1"
    >
    <title>Slider | iTwinUI</title>
    <link
      rel="stylesheet"
      href="../../lib/css/all.css"
    />
    <link
      rel="stylesheet"
      href="../assets/demo.css"
    />
    <style>
      section[id^='demo'] {
        width: auto;
      }

      /* Gives left & right labels an equal width so the slider is centered. */
      .iui-slider-min,
      .iui-slider-max {width: 25px;}

      .iui-tooltip {
        display: none;
      }

      .iui-slider-container .iui-slider-thumb:focus + .iui-tooltip,
      .iui-slider-container .iui-slider-thumb:hover + .iui-tooltip,
      .iui-slider-container .iui-slider-thumb.iui-active + .iui-tooltip {
        position: absolute;
        display: block;
        margin-top: -32px;
        transform: translateX(-50%);
      }
    </style>

    <script>
      customElements.define('svg-sound-mute', class extends HTMLElement {
        connectedCallback() {
          this.innerHTML = `<svg viewBox="0 0 16 16"><path d="m10.69329 1.72743-4.18186 3.26672h-2.04743a.949.949 0 0 0 -.964.93685v4.12776a.949.949 0 0 0 .964.9368h2.04743l4.19857 3.27451a1.10972 1.10972 0 0 0 1.78935-.8695l.00065-10.82006a1.12618 1.12618 0 0 0 -1.8069-.85318z" /></svg>`;
        }
      });
    </script>
    <script>
      customElements.define('svg-sound-loud', class extends HTMLElement {
        connectedCallback() {
          this.innerHTML = `<svg viewBox="0 0 16 16"><path d="m11.72617 5.17223a3.63009 3.63009 0 0 1 -.03351 5.66956.813.813 0 0 1 -1.09357-.13472l-.067-.067a.70591.70591 0 0 1 .11763-1.00944 2.02606 2.02606 0 0 0 .08409-3.19663.80271.80271 0 1 1 .99236-1.26181zm1.83433-2.25413a.81449.81449 0 0 0 -1.11066.11764.79447.79447 0 0 0 .10121 1.11066 4.96391 4.96391 0 0 1 0 7.70477.80191.80191 0 0 0 1.00945 1.24538 6.52839 6.52839 0 0 0 0-10.17859zm-6.36721-1.19067-4.18186 3.26672h-2.04743a.949.949 0 0 0 -.964.93685v4.12776a.949.949 0 0 0 .964.9368h2.04743l4.19857 3.27451a1.10972 1.10972 0 0 0 1.78935-.8695l.00065-10.82006a1.12618 1.12618 0 0 0 -1.8069-.85318z" /></svg>`;
        }
      });
    </script>

    <script src="../assets/theme.js"></script>
  </head>

  <body class="iui-body">
    <theme-button></theme-button>
    <h1>Slider</h1>
    <hr />
    <br>

    <h2>Default</h2>
    <section id="demo-default">
      <div class="iui-input-container">
        <div class="iui-label">Volume</div>

        <div class="iui-slider-component-container iui-input-group">
          <span class="iui-slider-min">
            <svg-sound-mute
              class="iui-icon"
              aria-hidden="true"
            ></svg-sound-mute>
          </span>
          <div class="iui-slider-container iui-progress-slider">
            <div class="iui-slider-rail"></div>
            <div
              class="iui-slider-track"
              style="right: 50%;"
            ></div>
            <div
              style="left: 50%;"
              class="iui-slider-thumb"
              role="slider"
              tabindex="0"
              aria-label="Volume Setting"
              aria-valuemin="0"
              aria-valuenow="50"
              aria-valuemax="100"
              id="test-slider-1"
            ></div>
            <output
              class="iui-tooltip"
              style="left: 50%;"
            >
              50
            </output>
          </div>
          <span class="iui-slider-max">
            <svg-sound-loud
              class="iui-icon"
              aria-hidden="true"
            ></svg-sound-loud>
          </span>
        </div>

      </div>

      <br /><br />

      <div class="iui-input-container">
        <div class="iui-label">Slider with ticks</div>

        <div class="iui-slider-component-container iui-input-group">
          <span class="iui-slider-min">0</span>
          <div class="iui-slider-container iui-progress-slider">
            <div class="iui-slider-rail"></div>
            <div
              class="iui-slider-track"
              style="right: 50%;"
            ></div>
            <div
              style="left: 50%;"
              class="iui-slider-thumb"
              role="slider"
              tabindex="0"
              aria-label="Percent Complete"
              aria-valuemin="0"
              aria-valuenow="50"
              aria-valuemax="100"
              id="test-slider-2"
            ></div>
            <output
              class="iui-tooltip"
              style="left: 50%;"
            >
              50
            </output>
            <div class="iui-slider-ticks">
              <!-- You could generate the ticks based on your min, max & step values. -->
              <span class="iui-slider-tick">0</span>
              <span class="iui-slider-tick">10</span>
              <span class="iui-slider-tick">20</span>
              <span class="iui-slider-tick">30</span>
              <span class="iui-slider-tick">40</span>
              <span class="iui-slider-tick">50</span>
              <span class="iui-slider-tick">60</span>
              <span class="iui-slider-tick">70</span>
              <span class="iui-slider-tick">80</span>
              <span class="iui-slider-tick">90</span>
              <span class="iui-slider-tick">100</span>
            </div>
          </div>
          <span class="iui-slider-max">100</span>
        </div>

      </div>

      <br /><br />

      <div class="iui-input-container iui-disabled">
        <div class="iui-label">Disabled slider</div>

        <div class="iui-slider-component-container iui-input-group iui-disabled">
          <span class="iui-slider-min">0</span>
          <div class="iui-slider-container iui-progress-slider">
            <div class="iui-slider-rail"></div>
            <div
              class="iui-slider-track"
              style="right: 50%;"
            ></div>
            <div
              style="left: 50%;"
              class="iui-slider-thumb"
              role="slider"
              aria-label="Percent Complete"
              aria-valuemin="0"
              aria-valuenow="50"
              aria-valuemax="100"
              id="test-slider-2"
            ></div>
            <output
              class="iui-tooltip"
              style="left: 50%;"
            >
              50
            </output>
            <div class="iui-slider-ticks">
              <!-- You could generate the ticks based on your min, max & step values. -->
              <span class="iui-slider-tick">0</span>
              <span class="iui-slider-tick">10</span>
              <span class="iui-slider-tick">20</span>
              <span class="iui-slider-tick">30</span>
              <span class="iui-slider-tick">40</span>
              <span class="iui-slider-tick">50</span>
              <span class="iui-slider-tick">60</span>
              <span class="iui-slider-tick">70</span>
              <span class="iui-slider-tick">80</span>
              <span class="iui-slider-tick">90</span>
              <span class="iui-slider-tick">100</span>
            </div>
          </div>
          <span class="iui-slider-max">100</span>
        </div>

      </div>
    </section>

    <br />

    <h2>Ranges</h2>
    <section id="demo-range">
      <div class="iui-input-container">
        <div class="iui-label">Price range</div>

        <div class="iui-slider-component-container iui-input-group">
          <span class="iui-slider-min">0</span>
          <div class="
              iui-slider-container iui-range-slider">
            <div class="iui-slider-rail"></div>
            <div
              class="iui-slider-track"
              style="left: 20%; right: 20%;"
            ></div>
            <div
              style="left: 20%;"
              class="iui-slider-thumb"
              role="slider"
              tabindex="0"
              aria-label="Start Value"
              aria-valuemin="0"
              aria-valuenow="20"
              aria-valuemax="79"
              data-range-max="100"
            ></div>
            <output
              class="iui-tooltip"
              style="left: 20%;"
            >
              20
            </output>
            <div
              style="left: 80%;"
              class="iui-slider-thumb"
              role="slider"
              tabindex="0"
              aria-label="End Value"
              aria-valuemin="21"
              aria-valuenow="80"
              aria-valuemax="100"
              data-range-min="0"
            ></div>
            <output
              class="iui-tooltip"
              style="left: 80%;"
            >
              80
            </output>
          </div>
          <span class="iui-slider-max">100</span>
        </div>

      </div>

      <br /><br />

      <div class="iui-input-container">
        <div class="iui-label">Range with ticks</div>

        <div class="iui-slider-component-container iui-input-group">
          <span class="iui-slider-min">0</span>
          <div class="
            iui-slider-container iui-range-slider">
            <div class="iui-slider-rail"></div>
            <div
              class="iui-slider-track"
              style="left: 20%; right: 20%;"
            ></div>
            <div
              style="left: 20%;"
              class="iui-slider-thumb"
              role="slider"
              tabindex="0"
              aria-label="Start Value"
              aria-valuemin="0"
              aria-valuenow="20"
              aria-valuemax="79"
              data-range-max="100"
            ></div>
            <output
              class="iui-tooltip"
              style="left: 20%;"
            >
              20
            </output>
            <div
              style="left: 80%;"
              class="iui-slider-thumb"
              role="slider"
              tabindex="0"
              aria-label="End Value"
              aria-valuemin="21"
              aria-valuenow="80"
              aria-valuemax="100"
              data-range-min="0"
            ></div>
            <output
              class="iui-tooltip"
              style="left: 80%;"
            >
              80
            </output>
            <div class="iui-slider-ticks">
              <!-- You could generate the ticks based on your min, max & step values. -->
              <span class="iui-slider-tick">0</span>
              <span class="iui-slider-tick">10</span>
              <span class="iui-slider-tick">20</span>
              <span class="iui-slider-tick">30</span>
              <span class="iui-slider-tick">40</span>
              <span class="iui-slider-tick">50</span>
              <span class="iui-slider-tick">60</span>
              <span class="iui-slider-tick">70</span>
              <span class="iui-slider-tick">80</span>
              <span class="iui-slider-tick">90</span>
              <span class="iui-slider-tick">100</span>
            </div>
          </div>
          <span class="iui-slider-max">100</span>
        </div>

      </div>

      <br /><br />

      <div class="iui-input-container iui-disabled">
        <div class="iui-label">Disabled range</div>

        <div class="iui-slider-component-container iui-input-group iui-disabled">
          <span class="iui-slider-min">0</span>
          <div class="
            iui-slider-container iui-range-slider">
            <div class="iui-slider-rail"></div>
            <div
              class="iui-slider-track"
              style="left: 20%; right: 20%;"
            ></div>
            <div
              style="left: 20%;"
              class="iui-slider-thumb"
              role="slider"
              aria-label="Start Value"
              aria-valuemin="0"
              aria-valuenow="20"
              aria-valuemax="79"
              data-range-max="100"
            ></div>
            <output
              class="iui-tooltip"
              style="left: 20%;"
            >
              20
            </output>
            <div
              style="left: 80%;"
              class="iui-slider-thumb"
              role="slider"
              aria-label="End Value"
              aria-valuemin="21"
              aria-valuenow="80"
              aria-valuemax="100"
              data-range-min="0"
            ></div>
            <output
              class="iui-tooltip"
              style="left: 80%;"
            >
              80
            </output>
            <div class="iui-slider-ticks">
              <!-- You could generate the ticks based on your min, max & step values. -->
              <span class="iui-slider-tick">0</span>
              <span class="iui-slider-tick">10</span>
              <span class="iui-slider-tick">20</span>
              <span class="iui-slider-tick">30</span>
              <span class="iui-slider-tick">40</span>
              <span class="iui-slider-tick">50</span>
              <span class="iui-slider-tick">60</span>
              <span class="iui-slider-tick">70</span>
              <span class="iui-slider-tick">80</span>
              <span class="iui-slider-tick">90</span>
              <span class="iui-slider-tick">100</span>
            </div>
          </div>
          <span class="iui-slider-max">100</span>
        </div>

      </div>
    </section>

    <script>

      function setTooltip(percent, tooltip) {
        if (tooltip) {
          tooltip.style.left = `${percent}%`;
          tooltip.innerHTML = `${percent}`;
        }
      }

      function getMinValueFromThumb(thumb) {
        const minAtt = thumb.getAttribute("aria-valuemin");
        const dataRangeMinAtt = thumb.getAttribute("data-range-min");
        const min = parseInt(null !== dataRangeMinAtt ? dataRangeMinAtt : minAtt);
        return min;
      }

      function getMaxValueFromThumb(thumb) {
        const maxAtt = thumb.getAttribute("aria-valuemax");
        const dataRangeMaxAtt = thumb.getAttribute("data-range-max");
        const max = parseInt(null !== dataRangeMaxAtt ? dataRangeMaxAtt : maxAtt);
        return max;
      }

      function getMaxLimitValueFromThumb(thumb) {
        var maxAtt = thumb.getAttribute("aria-valuemax");
        var max = parseInt(maxAtt);
        return max;
      }

      function getMinLimitValueFromThumb(thumb) {
        var minAtt = thumb.getAttribute("aria-valuemin");
        var min = parseInt(minAtt);
        return min;
      }

      function getPercentFromThumb(thumb) {
        var valueAtt = thumb.getAttribute("aria-valuenow");
        var value = parseInt(valueAtt);
        var min = getMinValueFromThumb(thumb);
        var max = getMaxValueFromThumb(thumb);
        var percent = ((value - min) / (max - min)) * 100;
        return percent;
      }

      function moveSlider(event, thumb, track, progress, mode, toolTip, otherThumb) {
        var min = getMinValueFromThumb(thumb);
        var limitMin = getMinLimitValueFromThumb(thumb);
        var max = getMaxValueFromThumb(thumb);
        var limitMax = getMaxLimitValueFromThumb(thumb);
        var rect = track.getBoundingClientRect()
        var trackWidth = rect.width;
        var diffX = event.pageX - rect.left;
        if (diffX > rect.width)
          diffX = rect.width;
        if (diffX < 0)
          diffX = 0;

        var percent = parseInt(((max - min) * diffX) / trackWidth);
        if (percent < limitMin)
          percent = limitMin;
        if (percent > limitMax)
          percent = limitMax;

        thumb.setAttribute("aria-valuenow", percent);
        setTooltip(percent, toolTip)
        if (mode === "progress") {
          thumb.style.left = `${percent}%`;
          var progressPercent = 100 - percent;
          progress.style.right = `${progressPercent}%`;
        } else if (mode === "range-left") {
          otherThumb && otherThumb.setAttribute("aria-valuemin", percent + 1);
          thumb.style.left = `${percent}%`;
          progress.style.left = `${percent}%`;
        } else if (mode === "range-right") {
          otherThumb && otherThumb.setAttribute("aria-valuemax", percent - 1);
          thumb.style.left = `${percent}%`;
          var progressPercent = 100 - percent;
          progress.style.right = `${progressPercent}%`;
        }

        event.preventDefault();
        event.stopPropagation();
      }

      function getOtherRangeThumb(thumb) {
        var parent = thumb.parentNode;
        const allThumbs = parent.querySelectorAll(".iui-slider-thumb");
        for (var i = 0; i < allThumbs.length; i++) {
          if (allThumbs[i] !== thumb)
            return allThumbs[i];
        }
      }

      function getToolTip(thumb, mode) {
        const parent = thumb.parentNode;
        const tooltips = parent.querySelectorAll(".iui-tooltip");
        if (mode === "range-left")
          return tooltips[0];
        else if (mode === "range-right")
          return tooltips[1];

        return tooltips[0];
      }

      function initializeThumbProcessing(thumb, sliderContainer, mode) {
        const percent = getPercentFromThumb(thumb);
        let progress;
        const toolTip = getToolTip(thumb, mode);

        if (mode === "progress") {
          thumb.style.left = `${percent}%`;
          progress = sliderContainer.querySelector(".iui-slider-track");
          progressPercent = 100 - percent;
          progress.style.right = `${progressPercent}%`;
        } else if (mode === "range-left") {
          thumb.style.left = `${percent}%`;
          progress = sliderContainer.querySelector(".iui-slider-track");
          progress.style.left = `${percent}%`;
        } else if (mode === "range-right") {
          thumb.style.left = `${percent}%`;
          progress = sliderContainer.querySelector(".iui-slider-track");
          progressPercent = 100 - percent;
          progress.style.right = `${progressPercent}%`;
        }

        setTooltip(percent, toolTip)

        thumb.addEventListener("mousedown", function () {
          if (sliderContainer.parentElement.classList.contains('iui-disabled'))
            return;
          thumb.classList.add("iui-active");
          sliderContainer.classList.add("iui-grabbing");
          var otherThumb = getOtherRangeThumb(thumb);
          var ownerDoc = thumb.ownerDocument;
          var track = sliderContainer.querySelector(".iui-slider-rail");
          var handleMouseMove = function (event) {
            moveSlider(event, thumb, track, progress, mode, toolTip, otherThumb);
          };

          var handleMouseUp = function (event) {
            ownerDoc.removeEventListener('mousemove', handleMouseMove);
            ownerDoc.removeEventListener('mouseup', handleMouseUp);
            thumb.classList.remove("iui-active");
            sliderContainer.classList.remove("iui-grabbing");
          };

          // bind a mousemove event handler to move pointer
          ownerDoc.addEventListener('mousemove', handleMouseMove);

          // bind a mouseup event handler to stop tracking mouse movements
          ownerDoc.addEventListener('mouseup', handleMouseUp);

          event.preventDefault();
          event.stopPropagation();
        });
      }

      function initializeAllProgressSliders() {
        const allProgressSliderContainers = document.querySelectorAll(".iui-slider-container.iui-progress-slider");
        allProgressSliderContainers.forEach(progressSliderContainer => {
          const thumb = progressSliderContainer.querySelector(".iui-slider-thumb");
          initializeThumbProcessing(thumb, progressSliderContainer, "progress");
        });
      }

      function initializeAllRangeSliders() {
        const allRangeSliderContainers = document.querySelectorAll(".iui-slider-container.iui-range-slider");
        allRangeSliderContainers.forEach(rangeSliderContainer => {
          const thumbs = rangeSliderContainer.querySelectorAll(".iui-slider-thumb");

          const leftThumb = thumbs[0];
          if (leftThumb) {
            initializeThumbProcessing(leftThumb, rangeSliderContainer, "range-left");
          }

          const rightThumb = thumbs[1];
          if (rightThumb) {
            initializeThumbProcessing(rightThumb, rangeSliderContainer, "range-right");
          }
        });
      }

      initializeAllProgressSliders();
      initializeAllRangeSliders();
    </script>
  </body>
</html>
