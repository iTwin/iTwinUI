import{r as e,q as te,v as ne,w as oe,x as ae,y as B,z as le,A as re,C as se,f as W,D as ie,m as H,b as ue,E as ce,F as de,B as me,c as J,G as fe,H as pe,J as ve,n as ge}from"./index-DFYM8etK.js";import{u as be}from"./focusable-DV0zPFjk.js";import{L as I}from"./ListItem-PxNL2o0x.js";const Ce=s=>e.createElement(te,s,e.createElement("path",{d:"M6.003 4.807v6.4a.28.28 0 0 0 .443.24L9.9 8.27a.34.34 0 0 0 0-.48L6.446 4.566a.269.269 0 0 0-.443.24z"})),U=e.forwardRef((s,b)=>{let{className:f,trigger:x,positionReference:d,portal:p,popoverProps:P,children:v,...C}=s,M=e.useContext(q),E=p??M,n=ne(),i=oe(),o=ae(),{interactions:m,visible:u,onVisibleChange:R,...l}=P??{},{listNavigation:r,hover:h,...V}=m??{},[k,g]=B(!1,u,R),[y,F]=e.useState(!1),[O,D]=e.useState(null),{focusableElementsRef:N,focusableElements:L}=be(O,{filter:t=>t.filter(a=>!(t!=null&&t.some(S=>S.contains(a.parentElement))))}),[w,T]=e.useState(null),c=le({nodeId:i,visible:k,onVisibleChange:t=>t?g(!0):$(),interactions:{hover:n==null?h:{enabled:!!h&&!y,...h},...V},...l,middleware:{size:{maxHeight:"var(--iui-menu-max-height)"},...l.middleware}}),{getReferenceProps:Y,getFloatingProps:Z,getItemProps:z}=re([se(c.context,{activeIndex:w,focusItemOnHover:!1,listRef:N,onNavigate:T,...r})]);e.useEffect(()=>{let t=c.refs.setPositionReference;d!==void 0&&t(d)},[c.refs.setPositionReference,d]);let _=W(D,b,c.refs.setFloating),G=e.useRef(null),$=e.useCallback(()=>{var t;g(!1),o==null&&((t=G.current)==null||t.focus({preventScroll:!0}))},[o,g]);ie(e.useCallback(()=>{let t=a=>{(o===a.parentId&&i!==a.nodeId||o===a.nodeId)&&(g(!1),F(!1))};return n==null||n.events.on("onNodeFocused",t),()=>{n==null||n.events.off("onNodeFocused",t)}},[i,o,n==null?void 0:n.events,g]),()=>{},()=>{});let A=e.useCallback(({focusableItemIndex:t,userProps:a})=>z({...a,tabIndex:w!=null&&w>=0&&t!=null&&t>=0&&w===t?0:-1,onFocus:H(a==null?void 0:a.onFocus,()=>{queueMicrotask(()=>{F(!0)}),n==null||n.events.emit("onNodeFocused",{nodeId:i,parentId:o})}),onMouseEnter:H(a==null?void 0:a.onMouseEnter,S=>{t!=null&&t>=0&&T(t),S.target===S.currentTarget&&S.currentTarget.focus({focusVisible:!1})})}),[w,z,i,o,n==null?void 0:n.events]),ee=ue(x,t=>Y(c.getReferenceProps({"aria-haspopup":"menu",...t.props,"aria-expanded":c.open,ref:ce(G,c.refs.setReference)}))),K=c.open&&e.createElement(de,{portal:E},e.createElement(me,{as:"div",className:J("iui-menu",f),ref:_,...Z(c.getFloatingProps({role:"menu",...C}))},v));return e.createElement(e.Fragment,null,e.createElement(j.Provider,{value:e.useMemo(()=>({popoverGetItemProps:A,focusableElements:L}),[L,A])},e.createElement(q.Provider,{value:E},e.createElement(fe.Provider,{value:c.open},ee),n!=null?e.createElement(pe,{id:i},K):K)))}),j=e.createContext(void 0),q=e.createContext(void 0),xe=e.forwardRef((s,b)=>e.createElement(ve,null,e.createElement(Ee,{ref:b,...s})));let Ee=e.forwardRef((s,b)=>{let{menuItems:f,children:x,role:d="menu",visible:p,placement:P="bottom-start",matchWidth:v=!1,onVisibleChange:C,portal:M=!0,middleware:E,closeOnItemClick:n=!0,...i}=s,[o,m]=B(!1,p,C),u=e.useCallback(()=>{m(!1)},[m]),R=e.useMemo(()=>typeof f=="function"?f(u):f,[u,f]),l=e.useMemo(()=>({close:u}),[u]);return e.createElement(X.Provider,{value:n},e.createElement(Q.Provider,{value:l},e.createElement(U,{trigger:x,onKeyDown:H(s.onKeyDown,r=>{r.defaultPrevented||r.key==="Tab"&&m(!1)}),role:d,ref:b,portal:M,popoverProps:e.useMemo(()=>({placement:P,matchWidth:v,visible:o,onVisibleChange:m,middleware:E}),[v,E,P,m,o]),...i},R)))});const Q=e.createContext(void 0),X=e.createContext(void 0),Me=e.forwardRef((s,b)=>{let{className:f,children:x,isSelected:d,disabled:p,value:P,onClick:v,sublabel:C,size:M=C?"large":"default",icon:E,startIcon:n=E,badge:i,endIcon:o=i,role:m="menuitem",subMenuItems:u=[],...R}=s,l=e.useMemo(()=>u.length>0,[u.length]),r=e.useContext(j),h=e.useContext(Q),V=e.useContext(X)&&!l,k=e.useRef(null),g=ge(),y=e.useMemo(()=>({placement:"right-start",interactions:{click:!0,hover:!0,listNavigation:{nested:l,openOnArrowKeyDown:!0}}}),[l]),F=N=>{p||(V&&(h==null||h.close()),v==null||v(P??N))},O=r==null?void 0:r.focusableElements.findIndex(N=>N===k.current),D=e.createElement(I,{as:"button",type:"button",className:J("iui-button-base",f),actionable:!0,size:M,active:d,disabled:p,ref:W(k,b),role:m,tabIndex:d?0:-1,"aria-selected":d,"aria-haspopup":l?"true":void 0,"aria-controls":l?g:void 0,"aria-disabled":p,...(r==null?void 0:r.popoverGetItemProps)!=null?r.popoverGetItemProps({focusableItemIndex:O,userProps:{onClick:F}}):{onClick:F},...R},n&&e.createElement(I.Icon,{as:"span","aria-hidden":!0},n),e.createElement(I.Content,null,e.createElement("div",null,x),C&&e.createElement(I.Description,null,C)),!o&&l&&e.createElement(I.Icon,{as:"span","aria-hidden":!0},e.createElement(Ce,null)),o&&e.createElement(I.Icon,{as:"span","aria-hidden":!0},o));return e.createElement(e.Fragment,null,l&&!p?e.createElement(U,{id:g,trigger:D,popoverProps:y},u):D)});export{xe as D,Me as M,U as a};
